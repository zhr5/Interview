1.自我介绍
2.一直做支付吗？这三年，这个支付项目做了哪些工作，讲讲，说了项目分层架构，我负责的方向
3.重复下单方案，下单场景拷打，下单和库存扣减哪种模式，会有什么问题，超卖，下单成功库存扣减失败，价格计算在什么环节，优惠扣减在什么环节，怎么原子性执行、完整流程每个环节差不多都问了方案。包括通过tcc下单减库存消耗大（讲通过数据对账机制做），积分扣减怎么办？购物车什么时机清空，会不会出现购物车清空失败
4.重复支付方案，没怎么问。（本来准备了今年双十一支付宝故障，看看下次能不能用)
5.业务体量？转进 订单的分库分表方案，想减少开销不想生成卖家库，卖家ID怎么查询订单。
6.为什么基于乐观锁修改订单状态，为什么不用悲观锁，mysql怎么实现，如何提供的两种锁机制，还知道哪些锁，死锁是怎么产生（转进mysql死锁问题排查）
7.rocketmq怎么实现分布式事务，原理，怎么保证消息不丢失。
8.不知道哪里提了一句二清，问二清方案，提到服务商模式，建行监管账户，支付宝使用服务商模式，那微信渠道怎么解决二清
说下你知道的二清哪些方案，建行会提供哪些二清方案（随口说了通联和易宝和银行合作)，你们的社区电商的运营模式（自营？商家）商品的配送履约怎么做的（自提），供应链货源怎么做，资金流的流程，


1.支付中台、开放平台、单体微服务改造
2.项目架构
3.下单链路详解

团购电商参考美团优选
购物车模式

库存扣减模式
1.加购减库存
2.下单减库存
3.支付减库存
注意购物车批量扣减

幂等校验、通用参数校验、优惠校验、价格计算、库存锁定、优惠锁定、下单、清空购物车。
支付成功、库存扣减、优惠扣减。
超时取消、库存回退、优惠返还。

订单分库分表

小型：
建立关联表  商家+订单号 
结合数据库中间件的智能查询功能
现在有一些先进的数据库中间件，它们可以对复杂的分库分表架构进行智能查询。
这些中间件可以解析卖家 ID 和订单号（包含哈希后的买家 ID）之间的关系，根据预先配置的分库分表规则，自动构建查询路径。
例如，Sharding - Sphere 是一款流行的数据库分库分表中间件。它可以通过配置分库分表策略，如按照订单号哈希分表，同时考虑卖家 ID 的查询需求。当卖家查询订单时，Sharding - Sphere 根据卖家 ID 和订单号的关联关系（通过配置和规则解析），智能地引导查询到正确的分库分表组合，而不需要遍历所有的库和表。
大型：
CANAL  ES

场景：订单超时关闭+补单任务查询订单状态+异步通知订单请求  读多写少
悲观锁：selct t.status from t where order_no=' ' for update;
乐观锁

select version from t where order_no=' ';
update status='' and version=version=1 where where order_no=' ' and version='version';

mysql锁机制复习

rocketMQ/Kafka复习
https://www.yuque.com/fcant/sys/pe6gvp

二清

电商购物时价格计算的环节及方式如下：

### 前端计算
- **实时总价计算**：在购物车页面，前端通常会进行简单的价格计算，如根据商品的单价和用户输入的数量，实时计算出每件商品的小计金额，并汇总得出购物车中所有商品的总价。例如，用户在购物车中添加了3件单价为20元的商品，前端会立即计算出该商品的小计为60元，并更新购物车的总价.
- **优惠折扣初步展示**：对于一些明确的、无需复杂逻辑判断的优惠折扣，前端也会进行初步计算和展示。比如，商品有直接的8折优惠，前端可以在用户添加商品到购物车时，就计算出折后价格并显示给用户.

### 后端计算
- **复杂优惠逻辑计算**：当购物车勾选完提交订单时，后端会进行更为复杂和精确的价格计算。因为后端能够获取到更全面的信息，如用户的会员等级、可用优惠券、积分余额、商品的库存状态以及各种促销活动的详细规则等，从而根据这些信息来计算最终的订单价格 。例如，“满300减50”“满500打8折”等满减、满折活动，以及不同商品、不同店铺的优惠券叠加使用，还有积分抵扣现金等复杂的优惠组合，都需要后端根据具体的业务规则进行准确计算.
- **库存与价格关联计算**：后端还会检查商品的库存情况，若库存不足，可能会影响商品的实际价格或导致无法下单。比如，某商品标注的价格是在有一定库存基础上的优惠价，当库存低于某个阈值时，价格可能会恢复原价，或者该商品无法再以优惠价购买，这些都需要后端在计算价格时进行判断和处理.
- **运费计算**：根据用户购买商品的重量、体积、配送地址等因素计算运费，并将其加入到订单总价中。不同的商品可能有不同的运费计算方式，如按重量计费、按件数计费等，后端需要综合考虑这些因素来准确计算运费.
- **价格更新与一致性保证**：在订单生成后，如果商品价格发生变化，后端会根据相应的规则进行处理，如是否支持保价、是否需要重新计算价格等，以确保订单价格的准确性和一致性.